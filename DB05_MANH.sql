-- Active: 1741454255232@@127.0.0.1@3306@db05_manh
CREATE DATABASE DB05_MANH;
USE DB05_MANH;


CREATE TABLE COUNTRY
(
    COUNTRY_ID INT PRIMARY KEY CHECK(COUNTRY_ID > 0),
    COUNTRY_NAME VARCHAR(150)
);

CREATE TABLE PROVINCE
(
    PROVINCE_ID CHAR(3) PRIMARY KEY,
    PROVINCE_NAME VARCHAR(100),
    POPULATION INT CHECK(POPULATION > 0),
    AREA FLOAT CHECK(AREA > 0),
    COUNTRY_ID INT CHECK(COUNTRY_ID > 0),
    FOREIGN KEY (COUNTRY_ID) REFERENCES COUNTRY(COUNTRY_ID)
);

CREATE TABLE BORDER
(
    PROVINCE_ID CHAR(3),
    NATION_ID INT CHECK(NATION_ID > 0),
    PRIMARY KEY(PROVINCE_ID, NATION_ID),
    FOREIGN KEY (PROVINCE_ID) REFERENCES PROVINCE(PROVINCE_ID),
    FOREIGN KEY (NATION_ID) REFERENCES COUNTRY(COUNTRY_ID)
);

CREATE TABLE NEIGHBOR
(
    PROVINCE_ID CHAR(3),
    NEIGHBOR_ID CHAR(3),
    PRIMARY KEY(PROVINCE_ID, NEIGHBOR_ID),
    FOREIGN KEY (PROVINCE_ID) REFERENCES PROVINCE(PROVINCE_ID)
);

drop Table neighbor;

INSERT INTO COUNTRY VALUES
(704, 'VIETNAM'),
(418, 'LAOS'),
(116, 'CAMBODIA'),
(156, 'CHINA');

INSERT INTO PROVINCE VALUES 
('N01', 'HA NOI', 8000000, 3324.5, 704),
('N02', 'HA GIANG', 705100, 7914.9, 704),
('N03', 'CAO BANG', 530341, 6724.6, 704),
('N04', 'BAC KAN', 313905, 4859.4, 704),
('N05', 'TUYEN QUANG', 784811, 5867.3, 704),
('N06', 'LAO CAI', 730420, 6383.9, 704),
('N07', 'DIEN BIEN', 598856, 9541.2, 704),
('N08', 'LAI CHAU', 460196, 9068.8, 704),
('N09', 'SON LA', 1245743, 14174.4, 704),
('N10', 'YEN BAI', 821030, 6887.7, 704),
('N11', 'HOA BINH', 854131, 4590.6, 704),
('N12', 'THAI NGUYEN', 1243000, 3541.7, 704),
('N13', 'LANG SON', 781655, 8310.2, 704),
('N14', 'QUANG NINH', 1213000, 6177.7, 704),
('N15', 'BAC GIANG', 1694000, 3827.4, 704),
('N16', 'PHU THO', 1468000, 3528.1, 704),
('N17', 'VINH PHUC', 1150000, 1235.2, 704),
('N18', 'BAC NINH', 1243000, 822.7, 704),
('N19', 'HAI DUONG', 1890000, 1668.2, 704),
('N20', 'HAI PHONG', 2030000, 1523.9, 704),
('N21', 'HUNG YEN', 1223000, 930.2, 704),
('N22', 'THAI BINH', 1780000, 1542.5, 704),
('N23', 'HA NAM', 808200, 860.5, 704),
('N24', 'NAM DINH', 1910000, 1652.2, 704),
('N25', 'NINH BINH', 982487, 1386.8, 704),
('C26', 'THANH HOA', 3510000, 11129.5, 704),
('C27', 'NGHE AN', 3300000, 16493.7, 704),
('C28', 'HA TINH', 1280000, 5997.1, 704),
('C29', 'QUANG BINH', 895430, 8065.3, 704),
('C30', 'QUANG TRI', 632375, 4746.8, 704),
('C31', 'THUA THIEN HUE', 1140000, 5023.2, 704),
('C32', 'DA NANG', 1139000, 1285.4, 704),
('C33', 'QUANG NAM', 1500000, 10406.8, 704),
('C34', 'QUANG NGAI', 1270000, 5153.0, 704),
('C35', 'BINH DINH', 1540000, 6022.6, 704),
('C36', 'PHU YEN', 900000, 5060.6, 704),
('C37', 'KHANH HOA', 1380000, 5221.6, 704),
('C38', 'NINH THUAN', 590467, 3358.3, 704),
('C39', 'BINH THUAN', 1230000, 7812.8, 704),
('C40', 'KON TUM', 540438, 9674.5, 704),
('C41', 'GIA LAI', 1520000, 15536.9, 704),
('C42', 'DAK LAK', 1900000, 13125.4, 704),
('C43', 'DAK NONG', 622168, 6514.4, 704),
('C44', 'LAM DONG', 1280000, 9772.2, 704),
('S45', 'BINH PHUOC', 994679, 6871.5, 704),
('S46', 'TAY NINH', 1090000, 4039.6, 704),
('S47', 'BINH DUONG', 2400000, 2694.4, 704),
('S48', 'DONG NAI', 3100000, 5907.2, 704),
('S49', 'BA RIA - VUNG TAU', 1150000, 1989.5, 704),
('S50', 'HO CHI MINH', 9000000, 2095.6, 704),
('S51', 'LONG AN', 1690000, 4491.9, 704),
('S52', 'TIEN GIANG', 1780000, 2510.6, 704),
('S53', 'BEN TRE', 1280000, 2394.6, 704),
('S54', 'TRA VINH', 1000000, 2292.5, 704),
('S55', 'VINH LONG', 1100000, 1524.5, 704),
('S56', 'DONG THAP', 1700000, 3377.0, 704),
('S57', 'AN GIANG', 2150000, 3536.7, 704),
('S58', 'KIEN GIANG', 1820000, 6348.8, 704),
('S59', 'CAN THO', 1230000, 1439.2, 704),
('S60', 'HAU GIANG', 733017, 1601.7, 704),
('S61', 'SOC TRANG', 1300000, 3311.8, 704),
('S62', 'BAC LIEU', 900000, 2468.7, 704),
('S63', 'CA MAU', 1200000, 5294.8, 704);

INSERT INTO PROVINCE VALUES
('D01', 'BEIJING', 21540000, 16410.54, 156),
('D02', 'TIANJIN', 15600000, 11760.00, 156),
('D03', 'HEBEI', 75560000, 187700.00, 156),
('D04', 'SHANXI', 37180000, 156700.00, 156),
('D05', 'INNER MONGOLIA', 25340000, 1183000.00, 156),
('D06', 'LIAONING', 43590000, 148000.00, 156),
('D07', 'JILIN', 27170000, 187400.00, 156),
('D08', 'HEILONGJIANG', 37730000, 454800.00, 156),
('D09', 'SHANGHAI', 24240000, 6340.50, 156),
('D10', 'JIANGSU', 80290000, 102600.00, 156),
('D11', 'ZHEJIANG', 57370000, 101800.00, 156),
('D12', 'ANHUI', 63240000, 139600.00, 156),
('D13', 'FUJIAN', 39410000, 121400.00, 156),
('D14', 'JIANGXI', 46480000, 166900.00, 156),
('D15', 'SHANDONG', 100470000, 157100.00, 156),
('D16', 'HENAN', 96050000, 167000.00, 156),
('D17', 'HUBEI', 59170000, 185900.00, 156),
('D18', 'HUNAN', 68990000, 211800.00, 156),
('D19', 'GUANGDONG', 113460000, 179800.00, 156),
('D20', 'GUANGXI', 49260000, 236700.00, 156),
('D21', 'HAINAN', 9340000, 33900.00, 156),
('D22', 'CHONGQING', 31020000, 82400.00, 156),
('D23', 'SICHUAN', 83410000, 485000.00, 156),
('D24', 'GUIZHOU', 36000000, 176100.00, 156),
('D25', 'YUNNAN', 48300000, 394000.00, 156),
('D26', 'TIBET', 3440000, 1228400.00, 156),
('D27', 'SHAANXI', 38640000, 205800.00, 156),
('D28', 'GANSU', 26370000, 454000.00, 156),
('D29', 'QINGHAI', 6030000, 720000.00, 156),
('D30', 'NINGXIA', 6880000, 66400.00, 156),
('D31', 'XINJIANG', 24870000, 1664900.00, 156),
('D32', 'HONG KONG', 7482000, 1106.00, 156),
('D33', 'MACAU', 667400, 32.90, 156),
('D34', 'TAIWAN', 23560000, 36193.00, 156);

INSERT INTO PROVINCE VALUES
('L01', 'VIENTIANE', 948477, 3920, 418),
('L02', 'PHONGSALY', 177989, 16270, 418),
('L03', 'LUANG NAMTHA', 145289, 9325, 418),
('L04', 'OUDOMXAY', 307622, 15370, 418),
('L05', 'BOKEO', 179243, 6196, 418),
('L06', 'LUANG PRABANG', 431889, 16875, 418),
('L07', 'HOUAPHANH', 289393, 16600, 418),
('L08', 'XIENG KHUANG', 244684, 15480, 418),
('L09', 'KHAMMOUANE', 392052, 16500, 418),
('L10', 'SAVANNAKHET', 969697, 21774, 418),
('L11', 'SALAVAN', 396891, 10691, 418),
('L12', 'SEKONG', 113048, 8120, 418),
('L13', 'CHAMPASAK', 694023, 15415, 418),
('L14', 'ATTAPEU', 127285, 10410, 418),
('L15', 'VIENTIANE PROVINCE', 419090, 15210, 418),
('L16', 'BOLIKHAMXAY', 273691, 14863, 418),
('L17', 'XAYSOMBOUN', 85000, 8500, 418);

INSERT INTO PROVINCE VALUES
('M01', 'PHNOM PENH', 1500000, 678, 116),
('M02', 'BANTEAY MEANCHEY', 678033, 6679, 116),
('M03', 'BATTAMBANG', 793129, 11702, 116),
('M04', 'KAMPONG CHAM', 1184788, 10136, 116),
('M05', 'KAMPONG CHHNANG', 527632, 5521, 116),
('M06', 'KAMPONG SPEU', 716517, 7017, 116),
('M07', 'KAMPONG THOM', 631409, 13814, 116),
('M08', 'KAMPOT', 627884, 4873, 116),
('M09', 'KANDAL', 1185021, 3557, 116),
('M10', 'KOH KONG', 117481, 10909, 116),
('M11', 'KRATIE', 319217, 11094, 116),
('M12', 'MONDULKIRI', 71971, 14288, 116),
('M13', 'ODDAR MEANCHEY', 185443, 6158, 116),
('M14', 'PURSAT', 397161, 12692, 116),
('M15', 'PREAH VIHEAR', 171139, 13788, 116),
('M16', 'PREY VENG', 947357, 4883, 116),
('M17', 'RATANAKIRI', 150466, 10782, 116),
('M18', 'SIEM REAP', 896309, 10129, 116),
('M19', 'PREAH SIHANOUK', 235190, 2536, 116),
('M20', 'STUNG TRENG', 111734, 11992, 116),
('M21', 'SVAY RIENG', 482788, 2966, 116),
('M22', 'TAKEO', 843931, 3563, 116),
('M23', 'KEP', 40980, 336, 116),
('M24', 'PAILIN', 71619, 803, 116),
('M25', 'TBOUNG KHMUM', 755000, 5248, 116);

INSERT INTO BORDER VALUES
('N02', 156),
('N03', 156),
('N06', 156),
('N07', 156),
('N07', 418), 
('N08', 156),
('N09', 418), 
('N13', 156), 
('N14', 156), 
('C26', 418), 
('C27', 418), 
('C28', 418), 
('C29', 418), 
('C30', 418), 
('C31', 418),
('C33', 418), 
('C40', 418), 
('C40', 116), 
('C41', 116),
('C42', 116), 
('C43', 116), 
('S45', 116),
('S46', 116), 
('S51', 116), 
('S56', 116), 
('S57', 116), 
('S58', 116);

DROP TABLE NEIGHBOR;

INSERT INTO NEIGHBOR VALUES
('N01', 'N12'), 
('N01', 'N16'),
('N01', 'N11'),  
('N01', 'N17'), 
('N01', 'N18'), 
('N01', 'N19'), 
('N01', 'N21'), 
('N01', 'N23'),
('N02', 'N03'),
('N02', 'N05'),
('N03', 'N02'),
('N03', 'N04'),
('N04', 'N03'),
('N04', 'N05'),
('N04', 'N12'),
('N05', 'N02'),
('N05', 'N04'),
('N05', 'N06'),
('N05', 'N10'),
('N06', 'N05'),
('N06', 'N08'),
('N06', 'N10'),
('N07', 'N08'),
('N07', 'N09'),
('N08', 'N06'),
('N08', 'N07'),
('N08', 'N10'),
('N09', 'N07'),
('N09', 'N10'),
('N09', 'N11'),
('N10', 'N06'),
('N10', 'N08'),
('N10', 'N09'),
('N10', 'N11'),
('N11', 'N09'),
('N11', 'N10'),
('N11', 'N12'),
('N11', 'N16'),
('N12', 'N01'),
('N12', 'N04'),
('N12', 'N11'),
('N12', 'N16'),
('N12', 'N17'),
('N13', 'N15'),
('N13', 'N14'),
('N14', 'N13'),
('N14', 'N15'),
('N14', 'N19'),
('N15', 'N13'),
('N15', 'N14'),
('N15', 'N18'),
('N15', 'N19'),
('N15', 'N20'),
('N16', 'N11'),
('N16', 'N12'),
('N16', 'N17'),
('N16', 'N26'),
('N17', 'N01'),
('N17', 'N12'),
('N17', 'N16'),
('N17', 'N26'),
('N18', 'N01'),
('N18', 'N15'),
('N18', 'N19'),
('N18', 'N21'),
('N19', 'N01'),
('N19', 'N14'),
('N19', 'N15'),
('N19', 'N18'),
('N19', 'N21'),
('N20', 'N15'),
('N20', 'N19'),
('N21', 'N01'),
('N21', 'N18'),
('N21', 'N19'),
('N21', 'N22'),
('N22', 'N21'),
('N22', 'N23'),
('N22', 'N24'),
('N23', 'N01'),
('N23', 'N22'),
('N23', 'N24'),
('N23', 'N25'),
('N24', 'N22'),
('N24', 'N23'),
('N24', 'N25'),
('N25', 'N23'),
('N25', 'N24'),
('N25', 'C26'),
('C26', 'N25'),
('C26', 'C27'),
('C27', 'C26'),
('C27', 'C28'),
('C28', 'C27'),
('C28', 'C29'),
('C29', 'C28'),
('C29', 'C30'),
('C30', 'C29'),
('C30', 'C31'),
('C31', 'C30'),
('C31', 'C32'),
('C32', 'C31'),
('C32', 'C33'),
('C33', 'C32'),
('C33', 'C34'),
('C34', 'C33'),
('C34', 'C35'),
('C35', 'C34'),
('C35', 'C36'),
('C36', 'C35'),
('C36', 'C37'),
('C37', 'C36'),
('C37', 'C38'),
('C38', 'C37'),
('C38', 'C39'),
('C39', 'C38'),
('C39', 'C40'),
('C40', 'C39'),
('C40', 'C41'),
('C41', 'C40'),
('C41', 'C42'),
('C41', 'C34'),
('C41', 'C35'),
('C41', 'C36'),
('C42', 'C41'),
('C42', 'C43'),
('C43', 'C42'),
('C43', 'S45'),
('S45', 'C43'),
('S45', 'S46'),
('S46', 'S45'),
('S46', 'S47'),
('S47', 'S46'),
('S47', 'S48'),
('S48', 'S47'),
('S48', 'S49'),
('S49', 'S48'),
('S49', 'S50'),
('S50', 'S49'),
('S50', 'S51'),
('S51', 'S50'),
('S51', 'S52'),
('S52', 'S51'),
('S52', 'S53'),
('S53', 'S52'),
('S53', 'S54'),
('S54', 'S53'),
('S54', 'S55'),
('S55', 'S54'),
('S55', 'S56'),
('S56', 'S55'),
('S56', 'S57'),
('S57', 'S56'),
('S57', 'S58'),
('S58', 'S57'),
('S58', 'S59'),
('S59', 'S58'),
('S59', 'S60'),
('S60', 'S59'),
('S60', 'S61'),
('S61', 'S60'),
('S61', 'S62'),
('S62', 'S61'),
('S62', 'S63'), 
('S63', 'S62');



SELECT * 
FROM PROVINCE 
WHERE AREA >= 15000 ;

SELECT NEI.NEIGHBOR_ID, PRO.*
FROM NEIGHBOR AS NEI
JOIN PROVINCE AS PR ON PR.PROVINCE_ID = NEI.PROVINCE_ID
JOIN PROVINCE AS PRO ON PRO.PROVINCE_ID = NEI.NEIGHBOR_ID
WHERE PR.AREA >= 15000; 

SELECT * 
FROM PROVINCE
WHERE PROVINCE_ID LIKE 'N%';

SELECT DISTINCT C.COUNTRY_NAME
FROM COUNTRY AS C
JOIN BORDER AS BOR ON BOR.NATION_ID = C.COUNTRY_ID
WHERE BOR.PROVINCE_ID LIKE 'N%';


SELECT LEFT(PROVINCE_ID, 1) AS REGION , AVG(AREA) AS AREA_AVENRAGE
FROM PROVINCE
WHERE PROVINCE_ID LIKE 'S%'
GROUP BY REGION; 

SELECT PROVINCE_ID, PROVINCE_NAME, (POPULATION / AREA) AS DENSITY
FROM PROVINCE
WHERE PROVINCE_ID LIKE 'C%';

SELECT PROVINCE_ID, PROVINCE_NAME, (POPULATION / AREA) AS DENSITY
FROM PROVINCE
WHERE PROVINCE_ID LIKE ('C%') 
OR PROVINCE_ID LIKE ('S%')
OR PROVINCE_ID LIKE ('N%')
AND DENSITY =
(SELECT MAX(SUB.MAX_DENSITY) 
FROM (
    SELECT (POPULATION / AREA) AS MAX_DENSITY
    FROM PROVINCE
    WHERE PROVINCE_ID LIKE ('C%') 
    OR PROVINCE_ID LIKE ('S%')
    OR PROVINCE_ID LIKE ('N%')
) AS SUB);

SELECT PROVINCE_ID, PROVINCE_NAME, (POPULATION / AREA) AS DENSITY
FROM PROVINCE
WHERE (PROVINCE_ID LIKE 'C%' 
   OR PROVINCE_ID LIKE 'S%' 
   OR PROVINCE_ID LIKE 'N%')
AND (POPULATION / AREA) = (
    SELECT MAX(POPULATION / AREA)
    FROM PROVINCE
    WHERE PROVINCE_ID LIKE 'C%' 
       OR PROVINCE_ID LIKE 'S%'
       OR PROVINCE_ID LIKE 'N%'
);


SELECT PROVINCE_ID, PROVINCE_NAME, AREA
FROM PROVINCE
WHERE (PROVINCE_ID LIKE 'C%' 
   OR PROVINCE_ID LIKE 'S%' 
   OR PROVINCE_ID LIKE 'N%')
AND AREA = (
    SELECT MAX(AREA)
    FROM PROVINCE
    WHERE PROVINCE_ID LIKE 'C%' 
       OR PROVINCE_ID LIKE 'S%'
       OR PROVINCE_ID LIKE 'N%'
);

SELECT BOR.PROVINCE_ID, PR.PROVINCE_NAME, COUNT(BOR.NATION_ID) AS COUNT_NATIONAL
FROM PROVINCE AS PR
JOIN BORDER AS BOR ON BOR.PROVINCE_ID = PR.PROVINCE_ID
GROUP BY BOR.PROVINCE_ID
HAVING COUNT(BOR.NATION_ID) > 1;

SELECT C.COUNTRY_ID,C.COUNTRY_NAME, COUNT(PR.PROVINCE_ID) AS COUNT_PROVINCE
FROM COUNTRY AS C
JOIN PROVINCE AS PR ON PR.COUNTRY_ID = C.COUNTRY_ID
GROUP BY COUNTRY_ID;

SELECT PR.PROVINCE_ID, PR.PROVINCE_NAME, COUNT(NEI.NEIGHBOR_ID) AS COUNT_NEIGHBOR
FROM PROVINCE AS PR
JOIN NEIGHBOR AS NEI ON NEI.PROVINCE_ID = PR.PROVINCE_ID
WHERE (PR.PROVINCE_ID LIKE 'C%' 
   OR PR.PROVINCE_ID LIKE 'S%' 
   OR PR.PROVINCE_ID LIKE 'N%')
GROUP BY PR.PROVINCE_ID
HAVING COUNT_NEIGHBOR = 
(SELECT MAX(SUB.MAX_COUNT)
FROM (
    SELECT COUNT(NEI.NEIGHBOR_ID) AS MAX_COUNT
    FROM NEIGHBOR AS NEI
    JOIN PROVINCE AS PR ON PR.PROVINCE_ID = NEI.PROVINCE_ID
    WHERE (PR.PROVINCE_ID LIKE 'C%' 
    OR PR.PROVINCE_ID LIKE 'S%' 
    OR PR.PROVINCE_ID LIKE 'N%')
    GROUP BY PR.PROVINCE_ID
) AS SUB);

SELECT PR.*
FROM PROVINCE AS PR
WHERE PR.AREA > ALL (
    SELECT PRV.AREA
    FROM NEIGHBOR AS NEI
    JOIN PROVINCE AS PRV ON NEI.NEIGHBOR_ID = PRV.PROVINCE_ID
    WHERE NEI.PROVINCE_ID = PR.PROVINCE_ID
) AND (PR.PROVINCE_ID LIKE 'C%' 
   OR PR.PROVINCE_ID LIKE 'S%' 
   OR PR.PROVINCE_ID LIKE 'N%');

SELECT C.COUNTRY_NAME, PR.PROVINCE_NAME, PR.AREA
FROM PROVINCE AS PR
JOIN COUNTRY AS C ON PR.COUNTRY_ID = C.COUNTRY_ID
WHERE PR.AREA > ALL (
    SELECT PRV.AREA
    FROM NEIGHBOR AS NEI
    JOIN PROVINCE AS PRV ON NEI.NEIGHBOR_ID = PRV.PROVINCE_ID
    WHERE NEI.PROVINCE_ID = PR.PROVINCE_ID
);



SELECT C.COUNTRY_NAME, PR.PROVINCE_NAME, PR.AREA
FROM PROVINCE AS PR
JOIN COUNTRY AS C ON PR.COUNTRY_ID = C.COUNTRY_ID
WHERE PR.AREA = (
    SELECT MAX(PRV.AREA)
    FROM PROVINCE AS PRV
    WHERE PRV.COUNTRY_ID = C.COUNTRY_ID
);


SELECT PR.PROVINCE_ID, PR.PROVINCE_NAME, PR.POPULATION
FROM PROVINCE AS PR
JOIN COUNTRY AS C ON PR.COUNTRY_ID = C.COUNTRY_ID
WHERE PR.POPULATION > (
    SELECT AVG(PRV.POPULATION)
    FROM PROVINCE AS PRV
    WHERE PRV.COUNTRY_ID = PR.COUNTRY_ID
);


SELECT C.* , SUM(PR.AREA)
FROM PROVINCE AS PR
JOIN COUNTRY AS C ON C.COUNTRY_ID = PR.COUNTRY_ID
GROUP BY C.COUNTRY_ID 
HAVING SUM(PR.AREA) = 
(SELECT MAX(SUB.MAX_AREA)
FROM (
    SELECT SUM(PRV.AREA) AS MAX_AREA
    FROM PROVINCE AS PRV
    GROUP BY PRV.COUNTRY_ID
) AS SUB);

SELECT C.* , SUM(PR.POPULATION)
FROM PROVINCE AS PR
JOIN COUNTRY AS C ON C.COUNTRY_ID = PR.COUNTRY_ID
GROUP BY C.COUNTRY_ID 
HAVING SUM(PR.AREA) = 
(SELECT MAX(SUB.MAX_AREA)
FROM (
    SELECT SUM(PRV.AREA) AS MAX_AREA
    FROM PROVINCE AS PRV
    GROUP BY PRV.COUNTRY_ID
) AS SUB);